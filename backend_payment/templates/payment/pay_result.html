{% extends 'base.html' %}
{% block title %}Статус заявки{% endblock %}
{% block content %}

    <style type="text/css">
	.st0{fill:#FFFFFF;}
	body {
{#background: linear-gradient(125deg, #207A89, #17A3BA 55%);#}
}

</style>



<div class="container margin: auto" style="max-width: 500px;">
  <div class="card" style="padding-left: 20px; padding-right: 20px; padding-bottom:20px; background: #efefef">
      <div class="row" >
          <div class="text-center card-header">
              <h2>Ödəniş statusu</h2>{# Статус платежа #}
              <h5><i>{{ payment.id }}</i></h5>
          </div>
  </div>
    <div class="row">
          <div class="" style="text-align: center">
              <h5>Məbləğ: {{ payment.amount }} ₼</h5>
              <h5>Tarix: {{ payment.create_at|date:"d-m-Y H:i" }}</h5>
          </div>
    </div>

    <div class="row">
            <div class="text-center">
              {% if payment.screenshot %}
                  <p class="aligncenter"><img class="img-thumbnail" src="/media/{{payment.screenshot}}" width="300" height="600"></p>
              {% endif %}
            </div>
    </div>

    <div class="row ">
        <div class="row" style="text-align: center">
            <p>Ödənişinizin cari statusu:<br> {# Текущий статус вашего платежа #}

              {% if payment.status == -1 %}
                <b style= "color: #fa3131"> Imtina olundu</b></p> {# Отклонен #}
              {% elif payment.status == 9 %}
                <b style= "color: #00ff7c">Təstiqləndi</b></p> {# Подтвержден #}
                  <p class="aligncenter"><img class="img-thumbnail" src="/static/img/ok-icon.webp" width="50" ></p>
              {% else %}
                <b style= "color: #937800">Təstiqləmə gözlənilir</b></p> {# Ожидает подтверждения #}
                              <div class="text-center">
                  <p class="aligncenter"><img class="img-thumbnail" src="/static/img/wait.gif" width="50" ></p>
            </div>
              {% endif %}

              {% if payment.status != 9 and  payment.status != -1 %}
                <a href="{% url 'payment:pay_result' payment.id %}">Statusu yeniləyin</a> {# обновить статус #}
              {% endif %}
          </div>
    </div>

            <div id="support_info" style="display: none"></div>
            {% if payment.status != 9 and  payment.status != -1 %}
                {% include 'includes/result_timer.html' %}
            {% endif %}

    <div class="row">
            <div class="row text-center">
            {% if payment.confirmed_amount %}
              <span>Təstiqlənmiş məbləğ: {{ payment.confirmed_amount }} ₼</span><br> {# Подтвержденная сумма:  #}
                {% if payment.merchant.host %}
                  <span><a href="{{ payment.merchant.host }}">Yenidən səhifəyə qayıtmaq</a></span><br> {# Вернуться на сайт #}
                {% endif %}
            {% endif %}
          </div>
    </div>

        <div class="row ">
            <div class="row text-center">

                <p>Əgər 10 dəqiqə ərzində ödənişinizin statusu “Təsdiqləndi” kimi dəyişməzsə, o zaman çatda bizə sifariş nömrənizi yazın və ödənişin ekran görüntüsünü əlavə edin<br><b id="payment_id">{{ payment.id }}</b> <img onclick="CopyToClipboard('payment_id')" style="opacity: 0.5" class="img-thumbnail" width="32" height="32" src="https://i.pinimg.com/736x/c2/6a/2c/c26a2c7168cf2a4fd1443ee1e658d807.jpg"</p>
{#              Если в течении 10 минут статус вашего платежа не сменится на "Подтвержден", то напишите нам в  чат свой номер заказа и приложите скриншот оплаты</p>#}
            </div>
      </div>
</div>
</div>

    <script>
  function CopyToClipboard(containerid) {
  if (document.selection) {
    var range = document.body.createTextRange();
    range.moveToElementText(document.getElementById(containerid));
    range.select().createTextRange();
    document.execCommand("copy");
  } else if (window.getSelection) {
    var range = document.createRange();
    range.selectNode(document.getElementById(containerid));
    window.getSelection().addRange(range);
    document.execCommand("copy");
    alert("Номер скопирован")
  }
}
</script>



<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script>

var status = {{ payment.status }}

function yourFunction() {
    console.log( 'xxx' );
    console.log( status );
};

function getStatus() {
fetch('https://asu-payme.com/api/payment_status/', {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({
        'id': '{{payment.id}}}'
    })
}).then(response => response.json())
       .then(result => { if (status.toString() !== result['status'].toString()) {
           location.reload()
       } else {
           if (status.toString() !== '9') {
               setTimeout(() => {getStatus()}, 3000);
           }
       }
       })
}
        setTimeout(() => { getStatus() }, 3000);
</script>

<script src="//code.jivo.ru/widget/b2YKXyDPmC" async></script>

{% endblock %}

